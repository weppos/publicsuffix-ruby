# Welcome to PublicSuffix 2.0!

PublicSuffix 2.0 contains a rewritten internal representation and comparison logic that drastically increases the lookup performance. It also makes a breaking change to correctly become compliant with the the official PublicSuffix algorithm, and changes several internal and external APIs.

The list below documents the most relevant changes to help you upgrading from PublicSuffix 1.x to 2.x:

- The library is now 100% compliant with the official PublicSuffix algorithm. The major breaking change you may experience is that if a domain passed as input doesn't match any rule, the wildcard rule `*` is assumed. This means that unlisted TLDs will be considered valid by default, when they would have been invalid in 1.x. However, you can override this behavior to emulate the 1.x behavior if needed:

    ```ruby
    # 1.x:

    PublicSuffix.valid?("google.commm")
    # => false

    # 2.x:

    PublicSuffix.valid?("google.commm")
    # => true

    PublicSuffix.valid?("google.commm", default_rule: nil)
    # => false

    PublicSuffix::List.default_rule = nil
    PublicSuffix.valid?("google.commm")
    # => false
    ```

- The library adds the ability to ignore private domains either at runtime, or when parsing the list. These new options replace the `PublicSuffix::List.private_domains` class-level attribute, which is no longer available. Ignoring private domains when parsing the list is faster than doing it at runtime.

    ```ruby
    # Default behavior:

    PublicSuffix.domain("something.blogspot.com")
    # => "something.blogspot.com

    # Ignoring private domains:

    # Option 1, at runtime:
    PublicSuffix.domain("something.blogspot.com", ignore_private: true)
    # => "blogspot.com"

    # Option 2, loading a filtered list:
    PublicSuffix::List.default = PublicSuffix::List.parse(File.read(PublicSuffix::List::DEFAULT_LIST_PATH), private_domains: false)
    PublicSuffix.domain("something.blogspot.com")
    # => "blogspot.com"
    ```

- The library adds a new `PublicSuffix.domain` method that parses the input and returns the domain (combination of second level domain + suffix). This is a convenient helper to parse a domain name, for example when you need to determine the cookie or SSL scope.

- The library removes several redundant utility helpers, such as `Domain#rule`, `Domain#is_a_domain?`, `Domain#is_a_subdomain?`, `Domain#valid?`. You can easily obtain the same result by having a custom method that reconstructs the logic, and/or calling `PublicSuffix.{domain|parse}(domain.to_s)`.
